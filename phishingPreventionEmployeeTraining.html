<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Training</title>
    <link rel="stylesheet" href="/style.css"> <!-- Updated path -->
    <style>
        /* Training-specific styles */
        .resource-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .resource-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .resource-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #004c9b;
        }
        
        .resource-category {
            background-color: #e7f1ff;
            color: #004c9b;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }
        
        .resource-preview {
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .resource-link {
            display: inline-block;
            margin-top: 10px;
            color: #004c9b;
            text-decoration: none;
            font-weight: bold;
        }
        
        .resource-link:hover {
            text-decoration: underline;
        }
        
        .resource-date {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        #quiz-button {
            background-color: #004c9b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 20px auto;
            display: block;
        }
        
        #quiz-button:hover {
            background-color: #003366;
        }
        
        #resources-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            #resources-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="company-header">
        <div class="logo">
            <a href="/index.html"><img src="/Images/GOCLogo.png" alt="GOC Logo"></a> <!-- Updated path -->
        </div>
        <div class="company-name">
            <nav class="nav-bar">
                <ul>
                    <li><a href="/overview.html">Home</a></li> <!-- Updated path -->
                    <li><a href="/reviewReportedPhishingEmails.html">Reports</a></li> <!-- Updated path -->
                    <li><a href="/reviewlogs.html">Logs</a></li> <!-- Updated path -->
                    <li><a href="/phishingPreventionEmployeeTraining.html">Training</a></li> <!-- Updated path -->
                    <li><a href="/generateReports.html">Export Reports</a></li> <!-- Updated path -->
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="rectangle">
            <div class="pps"><h1>Employee Training</h1>
                <table class="phishing-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>This feature provides access to phishing prevention training resources including videos, articles, and interactive materials to help employees recognize and avoid phishing attempts.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="loading-message" style="text-align: center; padding: 20px;">
                <div class="loading-spinner"></div>
                <p>Loading training resources, please wait...</p>
            </div>

            <div id="resources-container">
                <!-- Resource cards will be dynamically added here by JavaScript -->
            </div>

            <div id="no-resources" style="text-align: center; display: none; padding: 20px;">
                No training resources available at this time.
            </div>

            <!-- "Take the Quiz!" Button -->
            <a href="/quiz.html">
                <button type="button" id="quiz-button">Take the Quiz!</button>
            </a>
        </div>
    </main>

    <footer>
        <div class="pps"></div>
        <div class="footer-links">
            <a href="#">Terms and Conditions</a> | <a href="#">Privacy</a>
        </div>
        <div class="footer-logo">
            <a href="/index.html"><img src="/Images/CanadaLogo.jpg" alt="Canada Logo"></a> <!-- Updated path -->
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loadingMessage = document.getElementById('loading-message');
            const resourcesContainer = document.getElementById('resources-container');
            const noResourcesMessage = document.getElementById('no-resources');
            
            // Show loading message and hide container initially
            loadingMessage.style.display = 'block';
            resourcesContainer.style.display = 'none';
            noResourcesMessage.style.display = 'none';

            // Fetch resources from the server
            fetch('https://testrepofinal.onrender.com/resources') // Updated to Render URL
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    loadingMessage.style.display = 'none';
                    
                    if (data && data.length > 0) {
                        // Clear container (though it should be empty)
                        resourcesContainer.innerHTML = '';
                        
                        data.forEach(resource => {
                            const resourceCard = document.createElement("div");
                            resourceCard.className = "resource-card";
                            
                            // Determine preview content based on resource type
                            let previewContent = '';
                            if (resource.website_link.endsWith('.mp4')) {
                                previewContent = `
                                    <video width="100%" controls>
                                        <source src="${resource.website_link}" type="video/mp4">
                                        Your browser does not support the video tag.
                                    </video>
                                `;
                            } else if (resource.website_link.endsWith('.png') || 
                                      resource.website_link.endsWith('.jpg') || 
                                      resource.website_link.endsWith('.jpeg')) {
                                previewContent = `
                                    <img src="${resource.website_link}" alt="${resource.resource_name}" style="width: 100%; max-height: 200px; object-fit: contain;">
                                `;
                            } else if (resource.website_link.endsWith('.pdf')) {
                                previewContent = `
                                    <embed src="${resource.website_link}" type="application/pdf" width="100%" height="200px">
                                `;
                            } else {
                                previewContent = `
                                    <div style="padding: 20px; text-align: center; background-color: #f5f5f5;">
                                        <p>No preview available</p>
                                        <a href="${resource.website_link}" target="_blank" class="resource-link">View Resource</a>
                                    </div>
                                `;
                            }
                            
                            resourceCard.innerHTML = `
                                <div class="resource-header">
                                    <div class="resource-title">${resource.resource_name}</div>
                                    <div class="resource-category">${resource.category}</div>
                                </div>
                                <div class="resource-date">Published: ${resource.published}</div>
                                <div class="resource-preview">
                                    ${previewContent}
                                    <a href="${resource.website_link}" target="_blank" class="resource-link">Open Resource</a>
                                </div>
                            `;
                            
                            resourcesContainer.appendChild(resourceCard);
                        });
                        
                        resourcesContainer.style.display = 'grid';
                    } else {
                        noResourcesMessage.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error fetching resources:', error);
                    loadingMessage.innerHTML = `
                        <p style="color: red;">Failed to load resources. Please try again later.</p>
                        <button onclick="window.location.reload()">Retry</button>
                    `;
                });
        });
    </script>
</body>
</html>